<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Daftar Pesanan Customer</title>
    <style>
    html, body {
        height: 100%;
        margin: 0;
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
    }

    .admin-dashboard {
        display: flex;
        min-height: 100vh; /* Ini penting agar sidebar mengikuti tinggi layar */
    }

    .sidebar {
        width: 20%;
        background: #2c3e50;
        color: white;
        padding: 20px;
    }

    .sidebar h2 {
        text-align: center;
        margin-bottom: 10px;
        font-size: 1.5rem;
        letter-spacing: 1px;
    }

    .menu {
        list-style: none;
        padding: 0;
    }

    .menu li {
        margin: 15px 0;
    }

    .menu a {
        text-decoration: none;
        color: white;
        font-size: 1.1rem;
        display: block;
        padding: 10px 15px;
        border-radius: 5px;
        transition: background 0.3s ease;
    }

    .menu a.active,
    .menu a:hover {
        color: #1abc9c;
    }

    .content {
        width: 80%;
        padding: 20px;
    }

    h2 {
        color: #2c3e50;
        font-size: 1.8rem;
        margin-bottom: 20px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }

    table, th, td {
        border: 1px solid #ddd;
    }

    th, td {
        padding: 10px;
        text-align: left;
    }

    th {
        background: #2c3e50;
        color: white;
    }

    td {
        background: #fff;
    }

    .btn {
        padding: 8px 15px;
        background: #1abc9c;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.9rem;
    }

    .btn:hover {
        background: #16a085;
    }

    select {
        padding: 5px;
        border-radius: 4px;
        border: 1px solid #ccc;
    }
</style>


</head>
<body>
<div class="admin-dashboard">
    <!-- Sidebar -->
    <div class="sidebar">
        <h2>Admin Panel</h2>
        <ul class="menu">
            <li><a href="/ind.html">Dashboard</a></li>
            <li><a href="/admin" class="active">List Menu</a></li>
            <li><a href="/admin/orders" class="active">Daftar Pesanan</a></li>
        </ul>
    </div>

    <!-- Content -->
    <div class="content">
        <h2>Daftar Pesanan Customer</h2>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Customer</th>
                    <th>Menu</th>
                    <th>Harga</th>
                    <th>Status</th>
                    <th>Tracking</th>
                    <th>Ubah</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="order : ${orders}">
                    <td th:text="${order.id}"></td>
                    <td th:text="${order.customer.customerNama}"></td>
                    <td th:text="${order.menu.namaMenu}"></td>
                    <td th:text="${order.harga}"></td>
                    <td th:text="${order.status}"></td>
                    <td>
                        <form class="update-form" data-id="[[${order.id}]]">
                            <select name="trackingStatus">
                                <option value="Order Diterima" th:selected="${order.trackingStatus == 'Order Diterima'}">Order Diterima</option>
                                <option value="Sedang Diproses" th:selected="${order.trackingStatus == 'Sedang Diproses'}">Sedang Diproses</option>
                                <option value="Siap Diambil" th:selected="${order.trackingStatus == 'Siap Diambil'}">Siap Diambil</option>
                            </select>
                            <button type="submit" class="btn">Update</button>
                        </form>
                    </td>
                    <td>
                        <!-- Tombol tambahan aksi (jika mau ditambahkan nanti) -->
                        <button class="btn" onclick="alert('Fitur tambahan nanti')">...</button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
<script>
function loadOrders() {
    fetch("/api/pesanan")
      .then(res => res.json())
      .then(data => {
        const tbody = document.querySelector("tbody");
        tbody.innerHTML = "";

        data.forEach(order => {
            const row = document.createElement("tr");

            row.innerHTML = `
              <td>${order.id}</td>
              <td>${order.customer.customerNama}</td>
              <td>${order.menu.namaMenu}</td>
              <td>${order.harga}</td>
              <td>${order.status}</td>
              <td>
                <form class="update-form" data-id="${order.id}">
                  <select name="trackingStatus">
                    <option value="Order Diterima" ${order.trackingStatus === 'Order Diterima' ? 'selected' : ''}>Order Diterima</option>
                    <option value="Sedang Diproses" ${order.trackingStatus === 'Sedang Diproses' ? 'selected' : ''}>Sedang Diproses</option>
                    <option value="Siap Diambil" ${order.trackingStatus === 'Siap Diambil' ? 'selected' : ''}>Siap Diambil</option>
                  </select>
                  <button type="submit" class="btn">Update</button>
                </form>
              </td>
              <td><button class="btn">...</button></td>
            `;

            tbody.appendChild(row);
        });

        // Tambahkan event listener ke semua form setelah datanya di-render
        document.querySelectorAll(".update-form").forEach(form => {
            form.addEventListener("submit", function(e) {
                e.preventDefault();
                const id = this.dataset.id;
                const status = this.querySelector("select").value;

                fetch(`/admin/orders/update-tracking/${id}`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded"
                    },
                    body: `trackingStatus=${encodeURIComponent(status)}`
                })
                .then(response => {
                    if (response.ok) {
                        alert("Status pesanan berhasil diupdate");
                        loadOrders(); // Refresh tampilan setelah update
                    } else {
                        alert("Berhasil update status");
                    }
                })
                .catch(error => {
                    console.error("Error:", error);
                    alert("Terjadi kesalahan");
                });
            });
        });
      });
}

// Jalankan saat halaman pertama kali dimuat
loadOrders();
</script>

</body>
</html>
